#!/bin/zsh

# =================================================================
#  Kali Linux - Automatisches System-Upgrade mit Logging
#  Autor: KaliGem
#  Version: 2.0
# =================================================================

# 1. PrÃ¼fen, ob das Skript mit root-Rechten ausgefÃ¼hrt wird
if [[ $EUID -ne 0 ]]; then
   echo "ğŸ›‘ Fehler: Dieses Skript muss mit root-Rechten (sudo) ausgefÃ¼hrt werden."
   exit 1
fi

# --- NEUER ABSCHNITT: Logging einrichten ---
# Log-Verzeichnis definieren und erstellen, falls es nicht existiert
LOG_DIR="/home/guenther/.logs"
mkdir -p "$LOG_DIR"

# Log-Datei mit Zeitstempel definieren
LOG_FILE="$LOG_DIR/upgrade-$(date +"%Y-%m-%d_%H-%M-%S").log"

# Alle Ausgaben (stdout und stderr) in die Log-Datei und auf den Bildschirm umleiten
exec &> >(tee "$LOG_FILE")
# --- ENDE NEUER ABSCHNITT ---

echo "ğŸš€ Starte das automatische System-Upgrade fÃ¼r Kali Linux..."
echo "ğŸ“– Alle Ausgaben werden in der Datei '$LOG_FILE' gespeichert."
echo "--------------------------------------------------------"

# 2. Paketlisten aktualisieren (apt update)
echo "\n[INFO] Schritt 1/4: Paketlisten werden aktualisiert..."
if ! apt update -y; then
    echo "ğŸ›‘ Fehler bei 'apt update'. Skript wird abgebrochen."
    exit 1
fi

# 3. VollstÃ¤ndiges System-Upgrade durchfÃ¼hren (apt full-upgrade)
# full-upgrade ist fÃ¼r Kali empfohlen, da es auch AbhÃ¤ngigkeiten intelligent auflÃ¶st.
echo "\n[INFO] Schritt 2/4: VollstÃ¤ndiges System-Upgrade wird durchgefÃ¼hrt..."
if ! apt full-upgrade -y; then
    echo "ğŸ›‘ Fehler bei 'apt full-upgrade'. Skript wird abgebrochen."
    exit 1
fi

# 4. Nicht mehr benÃ¶tigte Pakete entfernen (apt autoremove)
echo "\n[INFO] Schritt 3/4: Nicht mehr benÃ¶tigte Pakete werden entfernt..."
if ! apt autoremove -y; then
    echo "ğŸ›‘ Fehler bei 'apt autoremove'."
    exit 1
fi

# 5. Heruntergeladene Paket-Dateien aufrÃ¤umen (apt clean)
echo "\n[INFO] Schritt 4/4: Paket-Cache wird aufgerÃ¤umt..."
apt clean

echo "\n--------------------------------------------------------"
echo "âœ… System-Upgrade erfolgreich abgeschlossen!"
echo "--------------------------------------------------------"

exit 0
